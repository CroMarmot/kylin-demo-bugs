var path=require("path"),parse=require("./parser"),genId=require("./gen-id"),normalize=require("./normalize"),loaderUtils=require("loader-utils"),querystring=require("querystring"),componentImport=require("./component-import"),componentParser=componentImport.componentParser,generateComponentDep=componentImport.generateComponentDep,componentBlockFormat=componentImport.componentBlockFormat,selectorPath=normalize.lib("selector"),styleRewriterPath=normalize.lib("style-rewriter"),templateLoaderPath=normalize.lib("template-loader"),templateCompilerPath=normalize.lib("template-compiler"),componentNormalizerPath=normalize.lib("component-normalizer"),styleLoaderPath=normalize.dep("vue-style-loader"),hotReloadAPIPath=normalize.dep("vue-hot-reload-api"),hasBabel=!1;try{hasBabel=!!require("babel-loader")}catch(e){}var hasBuble=!1;try{hasBuble=!!require("buble-loader")}catch(e){}var rewriterInjectRE=/\b(css(?:-loader)?(?:\?[^!]+)?)(?:!|$)/,defaultLang={template:"html",styles:"css",script:"js"},excludedPreLoadersRE=/eslint-loader/;function getRawRequest(e){return loaderUtils.getRemainingRequest({resource:e.resource,loaderIndex:e.loaderIndex,loaders:e.loaders.filter(e=>!excludedPreLoadersRE.test(e.path))})}module.exports=function(e){this.cacheable();var t="node"===this.target,n=this.minimize||"production"===process.env.NODE_ENV,r=this,o=loaderUtils.getOptions(this)||{},s=getRawRequest(this),a=this.options.__vueOptions__=Object.assign({},this.options.vue,this.vue,o),i=this.resourcePath,l=path.basename(i),c=this._compiler&&this._compiler.context||this.options.context||process.cwd(),u="data-v-"+genId(i,c,a.hashKey),p="";!n&&this.sourceMap&&!1!==a.cssSourceMap&&(p+="?sourceMap"),n&&(p+=(p?"&":"?")+"minimize");var d=hasBuble&&a.buble?"?"+JSON.stringify(a.buble):"",m="?"+JSON.stringify({id:u,transformToRequire:a.transformToRequire,preserveWhitespace:a.preserveWhitespace,buble:a.buble}),f={html:templateCompilerPath+m,css:styleLoaderPath+"!css-loader"+p,js:hasBuble?require.resolve("buble-loader")+d:hasBabel?require.resolve("babel-loader"):""},h=Object.assign({},f,a.loaders),y=a.preLoaders||{},g=a.postLoaders||{};function b(e,t,n,o){return"require("+function(e,t,n,o){return loaderUtils.stringifyRequest(r,"!!"+O(e,t,n,o)+function(e,t){return selectorPath+"?type="+("script"===e||"template"===e||"styles"===e?e:"customBlocks")+"&index="+t+"!"}(e,n||0)+s)}(e,t,n,o)+")"}function v(e,t,n){return"require("+function(e,t,n){return loaderUtils.stringifyRequest(r,"!!"+O(e,t,-1,n)+t.src)}(e,t,n)+")"}function q(e,t,n){if(!t.module)return e;var r=a.cssModules||{},o={modules:!0,importLoaders:!0},s={localIdentName:"[hash:base64]"};return e.replace(/((?:^|!)css(?:-loader)?)(\?[^!]*)?/,function(e,t,a){var i=loaderUtils.getOptions(a||{})||{};return Object.assign(i,s,r,o),-1!==n&&(i.localIdentName+="_"+n),t+"?"+JSON.stringify(i)})}function P(e){return e.map(function(e){return e&&"object"==typeof e&&"string"==typeof e.loader?e.loader+(e.options?"?"+JSON.stringify(e.options):""):e}).join("!")}function O(e,t,n,r){var s=function(e,t,n,r){var s=t.lang||defaultLang[e],a=h[s],i="";"styles"===e&&(i=styleRewriterPath+"?"+JSON.stringify({id:u,scoped:!!r,hasInlineConfig:!!o.postcss})+"!");var l="script"===e&&o.inject?"inject-loader!":"";if(null!=a)return Array.isArray(a)?a=P(a):"object"==typeof a&&(a=P([a])),"styles"===e&&(a=q(a,t,n),a=rewriterInjectRE.test(a)?a.replace(rewriterInjectRE,function(e,t){return I(t)+i}):I(a)+i),"template"===e&&a.indexOf(f.html)<0&&(a=f.html+"!"+a),l+I(a);switch(e){case"template":return f.html+"!"+templateLoaderPath+"?raw&engine="+s+"!";case"styles":return(a=q(f.css,t,n))+"!"+i+I(j(s));case"script":return l+I(j(s));default:return a=h[e],Array.isArray(a)&&(a=P(a)),I(a+function(e){var t=Object.assign({},e);delete t.src;var n=querystring.stringify(t);return n?"?"+n:n}(t.attrs))}}(e,t,n,r),a=t.lang||defaultLang[e];return y[a]&&(s+=I(y[a])),g[a]&&(s=I(g[a])+s),s}function j(e){return e.split("!").map(function(e){return e.replace(/^([\w-]+)(\?.*)?/,function(e,t,n){return(/-loader$/.test(t)?t:t+"-loader")+(n||"")})}).join("!")}function I(e){return"!"!==e.charAt(e.length-1)?e+"!":e}var R,C="",M=parse(e,l,this.sourceMap),x=M.styles.some(function(e){return e.scoped});if(C+="\nvar componentDeclaration\n",M.customBlocks&&M.customBlocks.length){var B=M.customBlocks.filter(componentBlockFormat),N=Object.create(null);B&&(C+="componentDeclaration = {}\n",B.forEach(function(e){componentParser(e,a).forEach(function(e){N[e.identifier],N[e.identifier]=e})})),Object.getOwnPropertyNames(N).forEach(function(e){var t=N[e];C+='componentDeclaration["'+t.identifier+'"] = '+generateComponentDep(t)+";\n"})}if(M.styles.length){C+="\n/* styles */\n";var k=!1;M.styles.forEach(function(e,t){var n=e.src?v("styles",e,e.scoped):b("styles",e,t,e.scoped),o=!0===e.module?"$style":e.module;o?(R||(R={}),k||(k=!0,C+="var cssModules = {}\n"),o in R?(r.emitError('CSS module name "'+o+'" is not unique!'),C+=n):(R[o]=!0,n.indexOf("style-loader")<0&&(n+=".locals"),C+='cssModules["'+o+'"] = '+n+"\n")):C+=n+"\n"}),C+="\n"}C+="var Component = require("+loaderUtils.stringifyRequest(r,"!"+componentNormalizerPath)+")(\n",C+="  /* script */\n  ";var _=M.script;_?(C+=_.src?v("script",_):b("script",_),o.inject&&(C+="(injections)")):C+="null",C+=",\n",C+="  /* template */\n  ";var w=M.template;if(C+=w?w.src?v("template",w):b("template",w):"null",C+=",\n",C+="  /* scopeId */\n  ",C+=(x?JSON.stringify(u):"null")+",\n",C+="  /* cssModules */\n  ",C+=R?"cssModules":"null",C+=",\n",C+="  /* componentDeclaration */\n",C+="  componentDeclaration",C+="\n",C+=")\n",n||(C+="Component.options.__file = "+JSON.stringify(i)+"\n",C+='if (Component.esModule && Object.keys(Component.esModule).some(function (key) {return key !== "default" && key !== "__esModule"})) {console.error("named exports are not supported in *.vue files.")}\n',w&&(C+='if (Component.options.functional) {console.error("[vue-loader] '+l+': functional components are not supported with templates, they should use render functions.")}\n')),M.customBlocks&&M.customBlocks.length){var z=!1;M.customBlocks.forEach(function(e,t){if(h[e.type]){e.src=e.attrs.src;var n=e.src?v(e.type,e):b(e.type,e,t);z||(C+="\n/* customBlocks */\n",z=!0),C+=n+"\n"}}),C+="\n"}return o.inject?C="\n/* dependency injection */\nmodule.exports = function (injections) {\n"+C+"\n\nreturn Component.exports\n}":(t||n||!M.script&&!M.template||(C+="\n/* hot reload */\nif (module.hot) {(function () {\n  var hotAPI = require("+JSON.stringify(hotReloadAPIPath)+')\n  hotAPI.install(require("vue"), false)\n  if (!hotAPI.compatible) return\n  module.hot.accept()\n  if (!module.hot.data) {\n    hotAPI.createRecord("'+u+'", Component.options)\n  } else {\n',R&&(C+="    if (module.hot.data.cssModules && JSON.stringify(module.hot.data.cssModules) !== JSON.stringify(cssModules)) {\n      delete Component.options._Ctor\n    }\n"),C+='    hotAPI.reload("'+u+'", Component.options)\n  }\n',R&&(C+="  module.hot.dispose(function (data) {\n    data.cssModules = cssModules\n  })\n"),C+="})()}\n"),a.esModule?C+='\nexports.__esModule = true;\nexports["default"] = Component.exports\n':C+="\nmodule.exports = Component.exports\n"),C};