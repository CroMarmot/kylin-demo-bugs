var babelPluginImport=require("./babel-plugin-import"),chalk=require("chalk"),path=require("path");function parseMemberImport(e,t){return(e=e.trim()).split(",").map(function(e){return e.trim().split("as").map(function(e){return e.trim()})}).map(function(e){return{identifier:e[1]||e[0],importName:e[0],attrs:t.attrs,src:t.attrs.src}})}function jsBlockRequire(e){return"default"===e.importName?'  var ret = require("'+e.src+'");\n  ret = ret.default || ret;\n':'  var ret = require("'+e.src+'");\n  ret = ret["'+e.importName+'"]'}function processNoSplitStyle(e){var t=null,r=e.attrs.style;if(r="false"!==(r="true"===r||r)&&r){"string"==typeof r&&(t={src:path.join(e.attrs.src,r)})}return t}exports.componentParser=function(e,t){var r=(t||{}).componentImport;(r=Array.isArray(r)?r:r&&"object"==typeof r?[r]:[]).forEach(function(t){t&&t.libraryName===e.attrs.src&&(e.attrs.componentImport=t,void 0===e.attrs.split&&(e.attrs.split="true"))});var o=null,n=null;if(e.attrs.component)if(/^\s*{.*?}\s*$/.test(e.attrs.component))n=(n=(n=e.attrs.component).replace(/^\s*{/,"")).replace(/}\s*$/,""),e.attrs.member=n;else{var a=(o=e.attrs.component).replace(/^\s*/,"").replace(/\s*$/,""),l=!1;if(/,/.test(a)&&(console.log(chalk.red(`[Error] mistake use <dependency component="${o}"> for member import\n`+`please try <dependency component="{${o}}">`)),console.log(chalk.red(`[Error] 可能错误使用 <dependency component="${o}"> 作为ES6成员命名导入\n`+`请尝试再左右加入或括号，如 <dependency component="{${o}}">`)),l=!0),/\s/.test(a)&&(console.log(chalk.red(`[Error] mistake use <dependency component="${o}"> for defalut import\n`+`component="{${o}}" within whitespace is not allowed`)),console.log(chalk.red(`[Error] 可能错误使用 <dependency component="${o}"> 作为ES6 default命名导入\n`+`component="{${o}}" 中不允许包含空格`)),l=!0),l)throw console.log(chalk.yellow('[Tips] visit "http://kylin.alipay.net/kylin/framework/component/spec.html#标签属性" for more help')),new Error("dependency-default-import-checkfail");e.attrs.default=o}return e.attrs.default?[{identifier:e.attrs.default,importName:"default",attrs:e.attrs,src:e.attrs.src}]:e.attrs.member?parseMemberImport(e.attrs.member,e):void 0},exports.generateComponentDep=function(e){var t="";if(void 0===e.attrs.split||e.attrs.member||console.log(chalk.yellow("[WARN] attribute 'split' without member exports will do nothing")),e.attrs.member&&void 0!==e.attrs.split){var r=babelPluginImport(e),o=r.js,n=r.style;t=jsBlockRequire(o)+(n?'  require("'+n.src+'");\n':"")}else{n=processNoSplitStyle(e);t=jsBlockRequire(e)+(n?' require("'+n.src+'") ':"")}return t="(function () { \n"+t+"\n  return ret; \n})()",void 0!==e.attrs.lazy?"function (resolve) {\nresolve( \n"+t+"\n);\n}":t},exports.componentBlockFormat=function(e){var t=!1,r=e.attrs;if(!e||"component"!==e.type&&"dependency"!==e.type||!e.attrs?t=!1:r.src?(r.default||r.member||r.component)&&(t=!0):t=!1,!t){var o=Object.keys(r).map(e=>""===r[e]?e:e+'="'+r[e]+'"').join(" ");console.log(chalk.yellow("[WARN] <"+e.type+" "+o+"> may be not available for current version of vue-loader"))}return"component"===e.type&&console.log(chalk.yellow("[WARN] should use <dependency> insteadof <component>")),r.component||(r.default&&console.log(chalk.yellow("[WARN] should use "+chalk.green(`<dependency component="${r.default}" />`)+" instead of "+chalk.green(`<${e.type} default="${r.default}" />`))),r.member&&console.log(chalk.yellow("[WARN] should use "+chalk.green(`<dependency component="{${r.member}}" />`)+" instead of "+chalk.green(`<${e.type} member="${r.member}" />`)))),t};