"use strict";exports.__esModule=!0;var _getIterator2=require("babel-runtime/core-js/get-iterator"),_getIterator3=_interopRequireDefault(_getIterator2),_create=require("babel-runtime/core-js/object/create"),_create2=_interopRequireDefault(_create);exports.default=function(e){e.messages,e.template;var r=e.types,t={ReferencedIdentifier:function(e,r){var t=r.imports,o=r.refIds,a=r.scope,i=e.node,n=i.name;t[n]&&a.getBinding(n)===e.scope.getBinding(n)&&(o[n]=o[n]||{},i.__lazy_identifier__?(o[n].lazy=o[n].lazy||0,o[n].lazy++):(o[n].ref=o[n].ref||0,o[n].ref++))},AssignmentExpression:function(e,r){},UpdateExpression:function(e,r){}},o={ObjectExpression:function(e,t){var o=t.refIds,a=e.node;if(a.__should_lazyrequire__){var i=t.imports;a.properties.forEach(function(t,a){if(r.isIdentifier(t.value)){var n=t.value.name;if(i[n]){var s=i[n];if(!(s.scope.getBinding(n)!==e.scope.getBinding(n)||o[n]&&o[n].ref)){var p=buildLazyRequire(r.stringLiteral(s.sourceValue));t.value=p,s.path.removed||s.path.remove()}}}})}}};function a(e){return!!e&&(1===e.length&&r.isImportDefaultSpecifier(e[0]))}function i(e){return!!e&&r.isStringLiteral(e)}function n(e,t){var o=e.node.body.body,a=t.opts,i=a.className,n=a.propertyName;a.propertyIgnoreName;o.forEach(function(e){if(r.isClassProperty(e)&&(null!==e.decorators&&(e.decorators=e.decorators||[],!(e.decorators.filter(function(e){return function(e,t,o){var a=o.opts,i=a.className,n=a.propertyName,s=a.propertyIgnoreName;return e.expression.name===s||r.isMemberExpression(e.expression)&&e.expression.object.name===i&&e.expression.property.name===n}(e,0,t)}).length>0)))){var o=r.Decorator(r.MemberExpression(r.Identifier(""+i),r.Identifier(""+n)));e.decorators.unshift(o)}})}return{inherits:require("babel-plugin-syntax-decorators"),pre:function(e){var r=this.opts.className,t=this.opts.propertyName,o=this.opts.propertyIgnoreName,a=this.opts.componentsPropertyName,i=this.opts.enableComponentLazyRequire,n=this.opts.enableRenderInjectH,s=this.opts.injectComponentName;this.opts={className:r||"Component",propertyName:t||"Property",propertyIgnoreName:o||t||"Property",componentsPropertyName:a||"components",enableComponentLazyRequire:void 0!==i&&i,enableRenderInjectH:void 0!==n&&n,injectComponentName:void 0!==s&&s}},visitor:{Program:{exit:function(e,n){var s=e.get("body"),p=(0,_create2.default)(null),l=s,c=Array.isArray(l),d=0;for(l=c?l:(0,_getIterator3.default)(l);;){var u;if(c){if(d>=l.length)break;u=l[d++]}else{if((d=l.next()).done)break;u=d.value}var f=u;if(f.isImportDeclaration()){var m=f.node,v=m.specifiers,y=m.source;if(a(v)&&i(y)){var _=v[0].local;if(!r.isIdentifier(_))return;var b=_.name,g=y.value;p[b]={sourceValue:g,path:f,scope:f.scope,processed:!1}}}}var h={};e.traverse(t,{imports:p,refIds:h,scope:e.scope}),e.traverse(o,{imports:p,refIds:h})}},ExportDefaultDeclaration:function(e){if(e.get("declaration").isClassDeclaration()){var t=e.node,o=t.declaration.id||e.scope.generateUidIdentifier("default");t.declaration.id=o,e.replaceWith(t.declaration),e.insertAfter(r.exportNamedDeclaration(null,[r.exportSpecifier(o,r.identifier("default"))]))}},ClassDeclaration:function(e,t){var o=e.node,a=o.id||e.scope.generateUidIdentifier("class"),i=r.variableDeclaration("let",[r.variableDeclarator(a,r.toExpression(o))]);e.replaceWith(i)},ClassExpression:function(e,t){var o=t.opts,a=o.className,i=(o.propertyName,e.node);if(!0!==e.node._add_decorator_&&(e.node._add_decorator_=!0,void 0!==i.decorators&&null!==i.decorators)){var s=i.decorators;if(!Array.isArray(s))throw e.buildCodeFrameError("unsupportet decorators format, should be Array");1===s.filter(function(e){return r.isIdentifier(e.expression)&&e.expression.name===a||r.isCallExpression(e.expression)&&r.isIdentifier(e.expression.callee)&&e.expression.callee.name===a}).length&&(function(e,t){if(t.opts.injectComponentName){var o=e.node.body.body,a=e.node,i=!1,n=!1,s=!1,p=a.id&&a.id.name;if(p&&(o.forEach(function(e){r.isIdentifier(e.key)&&!n?r.isClassProperty(e)?"name"===e.key.name&&(i=!0):r.isClassMethod(e)&&"name"===e.key.name&&(s=!0):n=!0}),!s&&!i)){var l=r.ClassProperty(r.Identifier("name"),r.StringLiteral(p),void 0,[],!1);l.static=!1,o.unshift(l)}}}(e,t),n(e,t),function(e,t){var o=e.node.body.body,a=t.opts,i=a.componentsPropertyName;a.enableComponentLazyRequire&&o.forEach(function(e){r.isClassProperty(e)&&!e.static&&r.isIdentifier(e.key)&&e.key.name===i&&r.isObjectExpression(e.value)&&(e.value.__should_lazyrequire__=!0,e.value.properties.forEach(function(e,t){r.isIdentifier(e.value)&&(e.value.__lazy_identifier__=!0)}))})}(e,t))}}}}};var _babelTemplate=require("babel-template"),_babelTemplate2=_interopRequireDefault(_babelTemplate);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var buildLazyRequire=(0,_babelTemplate2.default)("\n  function lazyRequire(resolve) {\n    resolve(require($0).default || require($0));\n  }\n");module.exports=exports.default;