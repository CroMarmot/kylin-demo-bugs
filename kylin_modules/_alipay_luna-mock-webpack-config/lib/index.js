"use strict";function handleRpcPrefix(o,e){for(var r in e)e.hasOwnProperty(r)&&(o=o.replace(r,e[r]));return o}function getSceneName(){var o=location.search.match(/[?&]luna-mock-scene=(\w+)/);return o&&o[1]||""}function handleSepcialDelay(o,e,r,t){if(o&&e in o)return setTimeout(function(){t&&t(r)},o[e]),!0}function handleJsapis(o){var e=[];return(o.jsapiContext&&o.jsapiContext.keys()||[]).forEach(function(o){var r=/^\.\/([^/]+)\/index\.js$/,t=/^\.\/([^/]+)\.js$/,c=void 0;r.test(o)?(c=o.match(r))&&e.push(c[1]):t.test(o)&&(c=o.match(t))&&e.push(c[1])}),e}function shouldAutoMockRpc(o,e){return"[object Boolean]"===Object.prototype.toString.call(e)?e:"[object Number]"===Object.prototype.toString.call(e)?Math.random()<e:"[object Array]"===Object.prototype.toString.call(e)&&e.indexOf(o)>=0}function mockRpcLimit(o){return console.info("「mock 限流」"+o),{error:1002}}function mockRpcError(o){console.info("「mock error」"+o);var e="LUNA_MOCK_ERROR_";return{resultStatus:e+"RESULT_STATUS",resultCode:e+"RESULT_CODE",success:!1,isSuccess:!1,resultDesc:e+"RESULT_DESC",resultView:e+"RESULT_VIEW",tips:e+"TIPS",memo:e+"MEMO",message:e+"MESSAGE"}}function lunaMockSimpleConfig(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=getSceneName();function t(t,c){return o.handleMockName?c=o.handleMockName(c):o.rpcPrefix&&(c=handleRpcPrefix(c,o.rpcPrefix)),function(n,i){var a=function(o,r){for(var t="rpc"===o?e.rpcContext:e.jsapiContext,c=["./"+r+".js","./"+r+"/index.js"],n=0;n<c.length;n++)try{return t(c[n])}catch(o){}console.error("没有找到 mock 文件: "+c.join(" 或 "))}(t,c);if(!a)return!1;var l="function"==typeof a?a(n,r):a;return"rpc"===t&&(shouldAutoMockRpc(c,o.autoMockRpcLimit)?l=mockRpcLimit(c):shouldAutoMockRpc(c,o.autoMockRpcError)&&(l=mockRpcError(c))),handleSepcialDelay(o.specialDelay,c,l,i)||(o.delay?setTimeout(function(){i&&i(l)},o.delay):i&&i(l)),!0}}var c={call:{}};c.call.rpc=function(o,e){t("rpc",o.operationType)(o,e)};var n=o.jsapis||handleJsapis(e);for(var i in n.forEach(function(o){c.call[o]=t("jsapi",o)}),c.call)o.useRealButLog&&(c.call[i]=!1);c.forbidAll=o.forbidAll,c.disableLog=o.disableLog,c.runInBrowser=o.runInBrowser,c.rpcMockList=o.rpcMockList,window.lunaMockConfig=c}module.exports=lunaMockSimpleConfig;