"use strict";exports.__esModule=!0,exports.exitPromiseVisitor=void 0,exports.addPromiseHelper=addPromiseHelper;var _babelTypes=require("babel-types"),t=_interopRequireWildcard(_babelTypes),_babelTemplate=require("babel-template"),_babelTemplate2=_interopRequireDefault(_babelTemplate);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r.default=e,r}var buildPromiseRequireFunc=(0,_babelTemplate2.default)("\n(function promiseRequire() {\n  if ($1) return $1;\n  if ( (typeof window !== 'undefined') && window.Promise && typeof window.Promise.resolve === 'function' ) {\n    $1 = window.Promise;\n  } else {\n    $1 = (require($0).default || require($0));\n  }\n  return $1;\n})\n"),exitPromiseVisitor=exports.exitPromiseVisitor={ReferencedIdentifier:function(e,r){var i=e.node,n=e.parent,o=e.scope;e.hub;if(!t.isMemberExpression(n)&&!o.getBindingIdentifier(i.name))if(r.opts.preferExternalPromise&&"Promise"==i.name)e.replaceWith(addPromiseHelper({file:e.hub.file,promise:"babel-runtime/core-js/promise"}));else if("Promise"===i.name){var a=r.addImport("babel-runtime/core-js/promise","default",i.name);e.replaceWith(a)}},MemberExpression:{exit:function(e,r){if(e.isReferenced()){var i=e.node,n=i.object;if(!e.scope.getBindingIdentifier(n.name))if(r.opts.preferExternalPromise&&"Promise"===n.name)e.replaceWith(t.memberExpression(addPromiseHelper({file:e.hub.file,promise:"babel-runtime/core-js/promise"}),i.property,i.computed));else if("Promise"===n.name){var o=r.addImport("babel-runtime/core-js/promise","default",n.name);e.replaceWith(t.memberExpression(o,i.property,i.computed))}}}}};function addPromiseHelper(e){var r=e.file,i=e.promise,n=t.stringLiteral(i),o=r.path;r.state;if(r.nebulaMeta=r.nebulaMeta||{},r.nebulaMeta.promiseHelperId)return r.nebulaMeta.promiseHelperId;var a=o.scope.generateUidIdentifier("ExternalPromise"),s=o.scope.generateUidIdentifier("ExternalPromiseCached"),l=buildPromiseRequireFunc(n,s).expression;return l.id=a,l.type="FunctionDeclaration",l._nebula_promise=!0,l.body._compact=!0,o.unshiftContainer("body",l),o.unshiftContainer("body",t.variableDeclaration("var",[t.variableDeclarator(s)])),r.nebulaMeta.promiseHelperId=t.CallExpression(a,[]),r.nebulaMeta.promiseHelperId}