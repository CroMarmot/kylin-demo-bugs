"use strict";exports.__esModule=!0,exports.processMethodList=processMethodList;var _babelTypes=require("babel-types"),t=_interopRequireWildcard(_babelTypes),_babelTemplate=require("babel-template"),_babelTemplate2=_interopRequireDefault(_babelTemplate),_lifecycle=require("./lifecycle"),_utils=require("../utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var buildComponentWatchBuilder=(0,_babelTemplate2.default)("\n  component.watch = component.watch || {};\n"),buildComponentWatchOptionBuilder=(0,_babelTemplate2.default)("\n  {\n    component.watch[$0] = $1 || {};\n    component.watch[$0]['handler'] = $2;\n  }\n");function filter(e){return"method"===e.kind&&!_lifecycle.lifeCycleHookMap[e.key.name]}function getWatchDecoratorsLength(e,r){var n=r.opts.watchName;return e?e.filter(function(e){return t.isCallExpression(e.expression)&&t.isIdentifier(e.expression.callee)&&e.expression.callee.name===n}).length:0}function processMethodList(e,r,n,o){var i=n.opts.watchName,a=[],l=[];return e.filter(filter).forEach(function(e){var r=e.decorators,l=getWatchDecoratorsLength(r,n);if(l>=1&&l===r.length)r.forEach(function(r){var n=r.expression.arguments,o=n[1]||t.objectExpression([]);a.push({key:n[0],option:o,handler:e.key.name})});else if(r&&r.length>0){var s=r.map(function(e){return e.expression.name||e.expression.callee&&e.expression.callee.name}).filter(Boolean);throw o.hub.file.buildCodeFrameError(e,"@"+i+" decorator should not be used with other decorators ["+s.filter(function(e){return e!==i})+"]")}}),a.length&&(l=generateStatements(a,n,o)),{properties:[],statements:l}}function generateStatements(e,r,n){var o=r.opts,i=(o.watchName,o.strict),a=[];return a.push(buildComponentWatchBuilder()),e.forEach(function(e){var r=e.key,o=e.option,l=e.handler;if(i){if(!t.isStringLiteral(r))throw n.hub.file.buildCodeFrameError(r,"Watch key should be primitive string.");if(!t.isObjectExpression(o))throw n.hub.file.buildCodeFrameError(o,"Watch option should be primitive object.")}a.push(buildComponentWatchOptionBuilder(r,o,t.stringLiteral(l)))}),a}