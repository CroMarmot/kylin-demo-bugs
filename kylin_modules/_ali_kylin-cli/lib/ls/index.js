"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ls,exports.lsGroup=lsGroup;var _chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_ora=require("ora"),_ora2=_interopRequireDefault(_ora),_userHome=require("user-home"),_userHome2=_interopRequireDefault(_userHome),_path=require("path"),_path2=_interopRequireDefault(_path),_utils=require("../utils"),_rimraf=require("rimraf"),_rimraf2=_interopRequireDefault(_rimraf),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_urllib=require("urllib"),_urllib2=_interopRequireDefault(_urllib);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function*ls(e){const r=e.args,t=(e.cwd,r[0]||"kylin-templates"),i=yield lsGroup(t);0==i.length?_utils.hint.warn("\n[List]",`检索库[${_chalk2.default.yellow(t)}]不存在有效kylin模板`):(_utils.hint.success(`\n检索到${i.length}个有效kylin模板\n`),i.forEach(e=>{console.log(e.graceful)}),console.log(""))}function*lsGroup(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return getGracefulRepos({groupName:e,repos:yield getRepo({groupName:e}),paddingNum:r})}function getGracefulRepos(e){e.groupName;var r=e.repos;let t=void 0===r?[]:r;var i=e.paddingNum;let l=void 0===i?0:i;const a=t.filter(e=>{const r=e.description||"";return/^\[ls\]/.test(r)}).map(e=>(e.description=e.description||"",e.description=e.description.replace(/^\[ls\]\s*/,""),e));if(0===a.length)return[];{const e=a.reduce((e,r)=>Math.max(e,getDisplayName(r).length),0);return a.map(r=>(r.graceful=`${getRepoDisplayName(r,e,l)}- ${r.description}`,r))}}function getDisplayName(e){return` - "${e.path}" `}function getRepoDisplayName(e,r,t){const i=getDisplayName(e),l=Math.ceil((r-i.length+(i.length+t)%8)/8);return` - "${_chalk2.default.yellow(e.path)}" `+new Array(l+1).join("\t")}function*getRepo(e){let r=e.groupName;var t=yield _urllib2.default.request(`http://luna.dockerlab.alipay.net/api/getLibrariesFromGitlab?groupName=${r}`,{method:"GET",dataType:"json"});const i=t.status,l=t.data;let a="";if(200===i)return l;throw a=404===i?`检索仓库[${_chalk2.default.yellow(r)}]不存在`:`未知错误${i}: ${JSON.stringify(l)}`,_utils.hint.error("[List]",a),new Error("ListData")}