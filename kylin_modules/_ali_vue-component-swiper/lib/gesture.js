"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var EVENTS=["touchstart","touchmove","touchend","touchcancel","touchfinish","move"],PI=Math.acos(-1),DIRECTION={horizontal:"horizontal",vertical:"vertical"},Gesture=function(){function t(e){if(_classCallCheck(this,t),this.init(),"string"==typeof e?this.element=document.querySelector(e):e instanceof window.HTMLElement&&(this.element=e),!this.element)throw new Error('"el" is not a HTMLElement, nor a valid selector');this.handleRawEvents()}return _createClass(t,[{key:"init",value:function(){var t=this;this.element=null,this.callbacks={},this.direction=null,this.start=null,this.startAt=null,this.lastTouchPosition=null,this.lastTouchTime=null,this.currentTouchPosition=null,this.currentTouchTime=null,["onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"].forEach(function(e){t[e]=t[e].bind(t)})}}]),_createClass(t,[{key:"on",value:function(t,e){if(!~EVENTS.indexOf(t))throw new Error(t+" is not a valid event");(this.callbacks[t]||(this.callbacks[t]=[])).push(e)}},{key:"emit",value:function(t){for(var e=this,i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];this.callbacks[t]&&this.callbacks[t].forEach(function(t){t.apply(e,n)})}},{key:"off",value:function(t,e){this.callbacks[t]&&(this.callbacks[t]=void 0!==e?this.callbacks[t].filter(function(t){return t!==e}):[])}},{key:"handleRawEvents",value:function(){this.element.addEventListener("touchstart",this.onTouchStart),this.element.addEventListener("touchmove",this.onTouchMove),this.element.addEventListener("touchend",this.onTouchEnd),this.element.addEventListener("touchcancel",this.onTouchCancel)}},{key:"dispose",value:function(){this.callbacks={},this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchmove",this.onTouchMove),this.element.removeEventListener("touchend",this.onTouchEnd),this.element.removeEventListener("touchcancel",this.onTouchCancel)}},{key:"onTouchStart",value:function(t){this.emit("touchstart",t),this.start={x:t.targetTouches[0].pageX,y:t.targetTouches[0].pageY},this.startAt=new Date}},{key:"onTouchMove",value:function(t){if(this.emit("touchmove",t),this.lastTouchPosition=this.currentTouchPosition,this.lastTouchTime=this.currentTouchTime,this.currentTouchPosition={pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},this.currentTouchTime=new Date,this.start){var e=t.changedTouches[0].pageX-this.start.x,i=t.changedTouches[0].pageY-this.start.y,n=void 0;null===this.direction&&(Math.abs(e)>Math.abs(i)?this.direction=DIRECTION.horizontal:this.direction=DIRECTION.vertical);var s=1e3*(n=this.direction===DIRECTION.horizontal?e:i)/(new Date-this.startAt),o=this.getAbsoluteDegree(e,i),h=this.getDirDegree(this.direction,o);this.emit("move",t,{direction:this.direction,distance:n,speed:s,degree:o,dirDegree:h})}}},{key:"onTouchEnd",value:function(t){this.emit("touchend",t),this.touchFinish(t)}},{key:"onTouchCancel",value:function(t){this.emit("touchcancel",t),this.touchFinish(t)}},{key:"touchFinish",value:function(t){var e=t.changedTouches[0].pageX-this.start.x,i=t.changedTouches[0].pageY-this.start.y,n=void 0;if(this.lastTouchPosition){var s=this.getDistance(this.direction,this.lastTouchPosition,this.currentTouchPosition),o=1e3*(n=this.direction===DIRECTION.horizontal?e:i)/(new Date-this.startAt),h=1e3*s/(this.currentTouchTime-this.lastTouchTime);this.emit("touchfinish",t,{direction:this.direction,distance:n,averageSpeed:o,speed:h}),this.start=null,this.direction=null,this.lastTouchPosition=null,this.lastTouchTime=null}else this.emit("touchfinish",t,{direction:null,distance:0,averageSpeed:0,speed:0})}},{key:"getAbsoluteDegree",value:function(t,e){var i=Math.sqrt(t*t+e*e),n=Math.acos(t/i);return e>0&&(n=2*PI-n),n/PI*180}},{key:"getDirDegree",value:function(t,e){if(!t)return 0;var i=Math.floor(e/90);if(t===DIRECTION.horizontal)switch(i){case 0:return e;case 1:case 2:return 180-e;case 3:return e-360}else switch(i){case 0:case 1:return e-90;case 2:case 3:return 270-e}}},{key:"getDistance",value:function(t,e,i){return t?t===DIRECTION.horizontal?i.pageX-e.pageX:i.pageY-e.pageY:0}}]),t}();exports.default=Gesture;