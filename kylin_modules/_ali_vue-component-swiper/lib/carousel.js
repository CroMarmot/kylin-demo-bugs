"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _gesture=require("./gesture"),_gesture2=_interopRequireDefault(_gesture);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function limit(t,i,e){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t<=i?i+~~s:t>=e?e-~~s:t}var cacheLength=1;exports.default={name:"Carousel",props:{autoScroll:{type:Boolean,default:!1},autoScrollDelay:{type:Number,default:1500},criticalDistance:{type:[Number,String],default:"20%"},cacheLength:{type:Number,default:1},transitionTime:{type:Number,default:.15},transitionTimingFunction:{type:String,default:"linear"},pagination:{type:Boolean,default:!1}},data:function(){return{current:0,offset:0,distance:0,status:"default",next:0}},computed:{childrenLength:function(){return this.$slots.default.length},elements:function(){for(var t=this,i=[0],e=[],s=0;s<this.cacheLength;s++)i.push(s+1),i.unshift(-s-1);var n=i.map(function(i){return(i+t.current+t.childrenLength)%t.childrenLength}),r=n.map(function(i){return t.$slots.default[i]});for(var a in"forward"===this.status?(r[this.cacheLength+1]=this.$slots.default[this.next],n[this.cacheLength+1]=this.next):"backward"===this.status&&(r[this.cacheLength-1]=this.$slots.default[this.next],n[this.cacheLength-1]=this.next),this.$slots.default)~n.indexOf(parseInt(a))||e.push(this.$slots.default[a]);return[].concat(r,e)}},watch:{autoScroll:function(t){t?this.startAutoScroll(this.autoScrollDelay):this.finishAutoScroll()},autoScrollDelay:function(t){this.restartAutoScroll(t)}},methods:{updateWidth:function(){this.width=parseInt(window.getComputedStyle(this.$el).width),this.scrollWidth=this.$refs.wrapper.scrollWidth,this.originOffset=-this.cacheLength*this.width},updateTransform:function(){var t=this.$refs.wrapper.style,i=limit(this.distance+this.offset,-this.width*(this.cacheLength+1),-this.width*(this.cacheLength-1));t.transform=t.webkitTransform=t.mozTransform=t.oTransform="translate3d("+i+"px,0,0)"},onStart:function(){this.finishAutoScroll()},onMove:function(t,i){var e=i.direction,s=i.distance;i.speed;"horizontal"===e&&(t.preventDefault(),this.distance=limit(s,-this.width,this.width,!0),this.updateTransform())},onFinish:function(){this.startAutoScroll(),this.setTransition(!0),this.next=this.current;var t=void 0;t="number"==typeof this.criticalDistance?this.criticalDistance:parseInt(this.criticalDistance)*this.width/100,Math.abs(this.distance)>=t&&(this.distance>0?this.offset=this.originOffset+this.width:this.offset=this.originOffset-this.width,this.next=(this.current+this.childrenLength-Math.abs(this.distance)/this.distance)%this.childrenLength),this.distance=0,this.updateTransform()},setTransition:function(t){var i=this.$refs.wrapper.style;i.transition=i.webkitTransition=i.mozTransition=i.oTransition=t?"all "+this.transitionTimingFunction+" "+this.transitionTime+"s":"none"},scrollToIndex:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";this.current===t||this.scrollToIndexLock||(this.scrollToIndexLock=!0,this.setTransition(!0),this.next=t,"default"===i&&(i=t<this.current||0===this.current&&this.next===this.childrenLength-1?"backward":"forward"),"backward"===i?(this.status="backward",this.offset=this.originOffset+this.width):(this.status="forward",this.offset=this.originOffset-this.width),this.updateTransform(),this.restartAutoScroll())},startAutoScroll:function(t){var i=this;this.autoScroll&&(this.autoScrollInterval=setInterval(function(){i.scrollToIndex((i.current+1)%i.childrenLength,"forward")},t||this.autoScrollDelay))},finishAutoScroll:function(){clearInterval(this.autoScrollInterval)},restartAutoScroll:function(t){this.finishAutoScroll(),this.startAutoScroll(t||this.autoScrollDelay)}},mounted:function(){var t=this;this.gesture=new _gesture2.default(this.$el),this.gesture.on("touchstart",this.onStart),this.gesture.on("move",this.onMove),this.gesture.on("touchfinish",this.onFinish),this.$refs.wrapper.addEventListener("transitionend",function(){t.setTransition(!1),t.next!==t.current&&(t.current=t.next,t.offset=t.originOffset,t.status="default",t.updateTransform(),t.scrollToIndexLock=!1,t.$emit("stop",t.current))}),this.autoScroll&&this.startAutoScroll(this.autoScrollDelay),this.updateWidth(),this.offset=this.originOffset,this.updateTransform()},updated:function(){this.updateWidth()},beforeDestroy:function(){this.gesture.dispose()},render:function(){var t=this,i=arguments[0];return i("div",{class:"am-swiper-container am-swiper-carousel"},[i("div",{class:"am-swiper-wrapper am-swiper-wrapper-slide",ref:"wrapper"},[this.elements]),this.pagination&&i("div",{class:"am-swiper-carousel-pagination"},[this.$slots.default.map(function(e,s){return i("div",{class:"am-swiper-carousel-pagination-dot"+(t.next===s?" active":""),on:{click:function(){return t.scrollToIndex(s)}}},[])})])])}};